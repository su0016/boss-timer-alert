<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>BOSS 計時器</title>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      fetch('/api/bosses')
        .then(response => response.json())
        .then(bosses => {
          const container = document.getElementById('bosses-container');
          bosses.forEach(boss => {
            const bossDiv = document.createElement('div');
            bossDiv.className = 'boss';
            bossDiv.innerHTML = `
              <h3>${boss.name}</h3>
              <p id="respawn-time-${boss.name}">下一次重生時間：${boss.respawnTime ? new Date(boss.respawnTime).toLocaleString() : '未知'}</p>
              <button onclick="setRespawnTime('${boss.name}')">設定重生時間</button>
            `;
            container.appendChild(bossDiv);
          });
        })
        .catch(error => console.error('Error fetching bosses:', error));
    });

    function setRespawnTime(bossName) {
      const time = prompt(`請輸入 ${bossName} 的下一次重生時間（格式：HH:mm）:`);
      if (time && /^\d{2}:\d{2}$/.test(time)) {
        fetch(`/api/boss/${encodeURIComponent(bossName)}/setRespawnTime`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ time }),
        })
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            alert(`錯誤：${data.error}`);
          } else {
            alert(data.message);
            document.getElementById(`respawn-time-${bossName}`).innerText = `下一次重生時間：${new Date(data.respawnTime).toLocaleString()}`;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('設定重生時間時出錯');
        });
      } else {
        alert('請輸入有效的時間格式（HH:mm）');
      }
    }
  </script>
</head>
<body>
  <h1>BOSS 計時器</h1>
  <div id="bosses-container"></div>
</body>
</html>
